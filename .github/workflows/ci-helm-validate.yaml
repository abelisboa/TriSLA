name: "CI - Helm Chart Validation"

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  helm-validate:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - uses: azure/setup-helm@v4

      - name: Lint
        run: helm lint helm/trisla

      - name: Template
        run: helm template trisla helm/trisla -f helm/trisla/values.yaml > rendered.yaml

      - name: Validate
        run: |
          if grep -Ei "error|failed|cannot|undefined|missing" rendered.yaml; then
            exit 1
          fi

      - uses: actions/upload-artifact@v4
        with:
          name: rendered
          path: rendered.yaml











































