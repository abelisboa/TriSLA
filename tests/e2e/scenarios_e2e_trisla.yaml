# Cenários de Teste E2E - TriSLA
# Validação End-to-End do fluxo completo I-01 → I-07

scenarios:
  - name: "URLLC - Cirurgia Remota / Missão Crítica"
    description: "Serviço URLLC com latência estrita, alta confiabilidade"
    intent_payload:
      intent_id: "e2e-urllc-001"
      tenant_id: "tenant-urllc-medical"
      service_type: "URLLC"
      sla_requirements:
        latency: "5ms"
        throughput: "10Mbps"
        reliability: 0.99999
        jitter: "1ms"
        packet_loss: 0.00001
      metadata:
        use_case: "remote_surgery"
        criticality: "mission_critical"
    
    expected_outcomes:
      semantic_validation:
        status: "success"
        ontology_validated: true
        gst_generated: true
        nest_generated: true
      
      ml_prediction:
        risk_level: "low"  # URLLC com requisitos dentro do esperado
        risk_score: "< 0.4"
        confidence: "> 0.7"
      
      decision:
        action: "ACCEPT"  # Esperado para URLLC válido
        reasoning: "URLLC requirements within acceptable range"
        slos_defined: true
      
      blockchain:
        registered: true
        sla_id: "> 0"
        transaction_hash: "present"
        events:
          - "SLARequested"
      
      agent_events:
        i06_events: ">= 0"  # Pode haver eventos de monitoramento
        i07_events: ">= 0"  # Pode haver ações executadas
        domains_monitored: ["RAN", "Transport", "Core"]
    
    validation_steps:
      - step: "1. Enviar Intent ao SEM-CSMF"
        endpoint: "POST /api/v1/intents"
        expected_status: 200
        assertions:
          - "response.status == 'accepted'"
          - "response.nest_id is not None"
          - "response.intent_id == 'e2e-urllc-001'"
      
      - step: "2. Verificar mensagem I-02 no Kafka"
        kafka_topic: "I-02-intent-to-ml"
        expected_message:
          interface: "I-02"
          source: "sem-csmf"
          destination: "ml-nsmf"
          intent_id: "e2e-urllc-001"
        timeout: 10
      
      - step: "3. Verificar mensagem I-03 no Kafka"
        kafka_topic: "I-03-ml-predictions"
        expected_message:
          interface: "I-03"
          source: "ml-nsmf"
          destination: "decision-engine"
          intent_id: "e2e-urllc-001"
        timeout: 15
      
      - step: "4. Verificar mensagem I-04 no Kafka"
        kafka_topic: "trisla-i04-decisions"
        expected_message:
          interface: "I-04"
          source: "decision-engine"
          destination: "bc-nssmf"
          decision:
            action: "ACCEPT"
            intent_id: "e2e-urllc-001"
        timeout: 20
      
      - step: "5. Verificar registro na blockchain"
        method: "web3"
        contract_address: "from contract_address.json"
        event: "SLARequested"
        filter:
          sla_id: "> 0"
        timeout: 30
      
      - step: "6. Verificar eventos I-06 dos agentes"
        kafka_topic: "trisla-i06-agent-events"
        expected_message:
          interface: "I-06"
          domain: "in ['RAN', 'Transport', 'Core']"
        timeout: 30
      
      - step: "7. Verificar observabilidade"
        prometheus_metrics:
          - "trisla_intents_total"
          - "trisla_decisions_total"
          - "trisla_sla_registrations_total"
        otlp_traces:
          - "span.name contains 'process_intent'"
          - "span.name contains 'decide'"
          - "span.name contains 'register_sla_blockchain'"

  - name: "eMBB - Vídeo 4K / Banda Larga Móvel"
    description: "eMBB com alta vazão, latência moderada"
    intent_payload:
      intent_id: "e2e-embb-001"
      tenant_id: "tenant-embb-media"
      service_type: "eMBB"
      sla_requirements:
        latency: "20ms"
        throughput: "500Mbps"
        reliability: 0.99
        jitter: "5ms"
      metadata:
        use_case: "4k_video_streaming"
        priority: "high"
    
    expected_outcomes:
      semantic_validation:
        status: "success"
        ontology_validated: true
        gst_generated: true
        nest_generated: true
      
      ml_prediction:
        risk_level: "low"  # eMBB com requisitos razoáveis
        risk_score: "< 0.5"
        confidence: "> 0.6"
      
      decision:
        action: "ACCEPT"  # Esperado para eMBB válido
        reasoning: "eMBB requirements acceptable"
        slos_defined: true
      
      blockchain:
        registered: true
        sla_id: "> 0"
        transaction_hash: "present"
        events:
          - "SLARequested"
      
      agent_events:
        i06_events: ">= 0"
        i07_events: ">= 0"
        domains_monitored: ["RAN", "Transport", "Core"]
    
    validation_steps:
      - step: "1. Enviar Intent ao SEM-CSMF"
        endpoint: "POST /api/v1/intents"
        expected_status: 200
        assertions:
          - "response.status == 'accepted'"
          - "response.nest_id is not None"
      
      - step: "2. Verificar fluxo completo I-02 → I-07"
        kafka_topics:
          - "I-02-intent-to-ml"
          - "I-03-ml-predictions"
          - "trisla-i04-decisions"
          - "trisla-i05-actions"
          - "trisla-i06-agent-events"
          - "trisla-i07-agent-actions"
        timeout: 30
      
      - step: "3. Verificar registro na blockchain"
        method: "web3"
        event: "SLARequested"
        timeout: 30

  - name: "mMTC - IoT Massivo"
    description: "mMTC com foco em densidade de dispositivos, menos crítico em latência"
    intent_payload:
      intent_id: "e2e-mmtc-001"
      tenant_id: "tenant-mmtc-iot"
      service_type: "mMTC"
      sla_requirements:
        latency: "500ms"
        throughput: "1Mbps"
        reliability: 0.9
        device_density: "1000000/km²"
      metadata:
        use_case: "massive_iot"
        device_type: "sensors"
    
    expected_outcomes:
      semantic_validation:
        status: "success"
        ontology_validated: true
        gst_generated: true
        nest_generated: true
      
      ml_prediction:
        risk_level: "medium"  # mMTC pode ter risco médio
        risk_score: "< 0.7"
        confidence: "> 0.5"
      
      decision:
        action: "ACCEPT"  # Esperado para mMTC válido
        reasoning: "mMTC requirements acceptable"
        slos_defined: true
      
      blockchain:
        registered: true
        sla_id: "> 0"
        transaction_hash: "present"
        events:
          - "SLARequested"
      
      agent_events:
        i06_events: ">= 0"
        i07_events: ">= 0"
        domains_monitored: ["RAN", "Transport", "Core"]
    
    validation_steps:
      - step: "1. Enviar Intent ao SEM-CSMF"
        endpoint: "POST /api/v1/intents"
        expected_status: 200
        assertions:
          - "response.status == 'accepted'"
          - "response.nest_id is not None"
      
      - step: "2. Verificar fluxo completo"
        kafka_topics:
          - "I-02-intent-to-ml"
          - "I-03-ml-predictions"
          - "trisla-i04-decisions"
        timeout: 30
      
      - step: "3. Verificar ações mínimas dos agentes"
        kafka_topic: "trisla-i07-agent-actions"
        expected_count: ">= 0"  # mMTC pode não exigir ações imediatas
        timeout: 30

# Configuração de ambiente E2E
environment:
  docker_compose_file: "docker-compose.yml"
  services:
    - "postgres"
    - "zookeeper"
    - "kafka"
    - "otlp-collector"
    - "prometheus"
    - "grafana"
    - "besu-dev"
    - "sem-csmf"
    - "ml-nsmf"
    - "decision-engine"
    - "bc-nssmf"
    - "sla-agent-layer"
    - "nasp-adapter"
  
  kafka_topics:
    - "I-02-intent-to-ml"
    - "I-03-ml-predictions"
    - "trisla-i04-decisions"
    - "trisla-i05-actions"
    - "trisla-i06-agent-events"
    - "trisla-i07-agent-actions"
  
  health_checks:
    sem_csmf: "http://localhost:8080/health"
    ml_nsmf: "http://localhost:8081/health"
    decision_engine: "http://localhost:8082/health"
    bc_nssmf: "http://localhost:8083/health"
    sla_agent_layer: "http://localhost:8084/health"
    nasp_adapter: "http://localhost:8085/health"
    besu: "http://localhost:8545"
    prometheus: "http://localhost:9090/-/healthy"
    grafana: "http://localhost:3000/api/health"

