# ============================================
# SLO Alerting Rules - TriSLA
# SLO por Interface (I-01 a I-07)
# ============================================

groups:
  - name: trisla_slo_by_interface
    interval: 30s
    rules:
      # I-01: SEM-CSMF → Decision Engine
      - alert: SLOLatencyViolationI01
        expr: |
          histogram_quantile(0.99, 
            rate(trisla_i01_request_duration_seconds_bucket[5m])
          ) > 0.1
        for: 5m
        labels:
          severity: critical
          component: trisla
          interface: "I-01"
        annotations:
          summary: "SLO Latency Violation - I-01"
          description: "I-01 p99 latency exceeds 100ms for 5 minutes"

      - alert: SLOThroughputViolationI01
        expr: |
          rate(trisla_i01_requests_total[5m]) < 100
        for: 5m
        labels:
          severity: warning
          component: trisla
          interface: "I-01"
        annotations:
          summary: "SLO Throughput Violation - I-01"
          description: "I-01 throughput below 100 req/s for 5 minutes"

      - alert: SLOErrorRateViolationI01
        expr: |
          (rate(trisla_i01_errors_total[5m]) / 
           rate(trisla_i01_requests_total[5m])) > 0.01
        for: 5m
        labels:
          severity: critical
          component: trisla
          interface: "I-01"
        annotations:
          summary: "SLO Error Rate Violation - I-01"
          description: "I-01 error rate exceeds 1% for 5 minutes"

      # I-02: ML-NSMF → Decision Engine
      - alert: SLOLatencyViolationI02
        expr: |
          histogram_quantile(0.99, 
            rate(trisla_i02_message_duration_seconds_bucket[5m])
          ) > 0.2
        for: 5m
        labels:
          severity: critical
          component: trisla
          interface: "I-02"
        annotations:
          summary: "SLO Latency Violation - I-02"
          description: "I-02 p99 latency exceeds 200ms for 5 minutes"

      # I-03: Decision Engine → ML-NSMF
      - alert: SLOLatencyViolationI03
        expr: |
          histogram_quantile(0.99, 
            rate(trisla_i03_message_duration_seconds_bucket[5m])
          ) > 0.2
        for: 5m
        labels:
          severity: critical
          component: trisla
          interface: "I-03"
        annotations:
          summary: "SLO Latency Violation - I-03"
          description: "I-03 p99 latency exceeds 200ms for 5 minutes"

      # I-04: Decision Engine → BC-NSSMF
      - alert: SLOLatencyViolationI04
        expr: |
          histogram_quantile(0.99, 
            rate(trisla_i04_request_duration_seconds_bucket[5m])
          ) > 0.5
        for: 5m
        labels:
          severity: critical
          component: trisla
          interface: "I-04"
        annotations:
          summary: "SLO Latency Violation - I-04"
          description: "I-04 p99 latency exceeds 500ms for 5 minutes"

      # I-05: Decision Engine → SLA-Agent Layer
      - alert: SLOLatencyViolationI05
        expr: |
          histogram_quantile(0.99, 
            rate(trisla_i05_message_duration_seconds_bucket[5m])
          ) > 0.2
        for: 5m
        labels:
          severity: critical
          component: trisla
          interface: "I-05"
        annotations:
          summary: "SLO Latency Violation - I-05"
          description: "I-05 p99 latency exceeds 200ms for 5 minutes"

      # I-06: SLA-Agent Layer → Decision Engine
      - alert: SLOLatencyViolationI06
        expr: |
          histogram_quantile(0.99, 
            rate(trisla_i06_event_duration_seconds_bucket[5m])
          ) > 0.2
        for: 5m
        labels:
          severity: critical
          component: trisla
          interface: "I-06"
        annotations:
          summary: "SLO Latency Violation - I-06"
          description: "I-06 p99 latency exceeds 200ms for 5 minutes"

      # I-07: NASP Adapter
      - alert: SLOLatencyViolationI07
        expr: |
          histogram_quantile(0.99, 
            rate(trisla_i07_request_duration_seconds_bucket[5m])
          ) > 1.0
        for: 5m
        labels:
          severity: critical
          component: trisla
          interface: "I-07"
        annotations:
          summary: "SLO Latency Violation - I-07"
          description: "I-07 p99 latency exceeds 1000ms for 5 minutes"

      # SLO Compliance Geral
      - alert: SLOComplianceLow
        expr: |
          trisla_slo_compliance_rate < 0.95
        for: 5m
        labels:
          severity: critical
          component: trisla
        annotations:
          summary: "SLO Compliance Below Threshold"
          description: "Overall SLO compliance is below 95% (current: {{ $value | humanizePercentage }})"

      - alert: SLOViolationsHigh
        expr: |
          rate(trisla_slo_violations_total[5m]) > 10
        for: 5m
        labels:
          severity: warning
          component: trisla
        annotations:
          summary: "High SLO Violations Rate"
          description: "SLO violations rate is above 10/min (current: {{ $value }}/min)"

