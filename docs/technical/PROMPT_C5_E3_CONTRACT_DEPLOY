Implantação Real de Smart Contract no Eixo Contratual (E3)

1. Contexto e Objetivo

Este protocolo define o procedimento oficial e rastreável para implantar (deploy) um smart contract real no Hyperledger Besu, utilizando o módulo BC-NSSMF, conforme projetado na arquitetura TriSLA.

O objetivo é validar experimentalmente o Eixo E3 (Contratual), comprovando que:

O BC-NSSMF é capaz de compilar e implantar contratos reais

O contrato é registrado on-chain

O endereço, ABI e metadados são persistidos

O processo ocorre sem alteração de código

A execução é auditável e reprodutível

Este protocolo não executa SLAs, apenas implanta o contrato, preparando o ambiente para testes contratuais subsequentes.

2. Ambiente de Execução (Obrigatório)

Host de acesso: node006

Usuário: porvir5g

Diretório base:

cd /home/porvir5g/gtp5g/trisla


Namespace Kubernetes: trisla

⚠️ Nenhuma execução deve ser feita fora desse contexto.

3. Pré-condições (FASE 0 — Obrigatória)
3.1 Verificação de conectividade
kubectl get pods -n trisla | egrep "besu|bc-nssmf"


Critério de continuidade:

trisla-besu-* → Running (1/1)

trisla-bc-nssmf-* → Running (1/1)

❌ Se houver CrashLoopBackOff, interromper o protocolo

3.2 Verificação de health do BC-NSSMF
kubectl -n trisla port-forward svc/trisla-bc-nssmf 8083:8083


Em outro terminal:

curl -s http://localhost:8083/health | jq


Resultado esperado:

{
  "status": "healthy",
  "module": "bc-nssmf",
  "enabled": true,
  "rpc_connected": true
}

3.3 Snapshot de segurança (rastreabilidade)
mkdir -p docs/experiments/C5_E3_CONTRACT_DEPLOY
kubectl get deployment trisla-bc-nssmf -n trisla -o yaml \
  > docs/experiments/C5_E3_CONTRACT_DEPLOY/FASE0_DEPLOYMENT_SNAPSHOT.yaml

4. Execução Experimental
FASE 1 — Deploy Real do Smart Contract

⚠️ Este é o endpoint correto e único para deploy contratual.

curl -X POST http://localhost:8083/api/v1/contract/deploy \
  -H "Content-Type: application/json" | tee \
  docs/experiments/C5_E3_CONTRACT_DEPLOY/response_deploy.json

4.1 Evidências esperadas na resposta

A resposta deve conter pelo menos:

contractAddress

txHash

blockNumber

status ou confirmação de sucesso

Exemplo esperado (variável conforme execução):

{
  "contractAddress": "0xabc123...",
  "txHash": "0xdef456...",
  "blockNumber": 128,
  "status": "DEPLOYED"
}

FASE 2 — Validação on-chain (sem código)
4.2.1 Confirmar persistência do contrato
kubectl exec -n trisla deploy/trisla-bc-nssmf -- \
  ls /app/src/contracts/


Arquivo obrigatório:

contract_address.json

4.2.2 Validar conteúdo do contrato implantado
kubectl exec -n trisla deploy/trisla-bc-nssmf -- \
  cat /app/src/contracts/contract_address.json | jq


Critério de sucesso:

address presente

abi presente

JSON válido

FASE 3 — Auditoria de Logs
kubectl logs -n trisla deploy/trisla-bc-nssmf \
  | egrep "deploy|contract|Besu|tx|block" \
  > docs/experiments/C5_E3_CONTRACT_DEPLOY/bc_nssmf_deploy.log

kubectl logs -n trisla deploy/trisla-besu \
  > docs/experiments/C5_E3_CONTRACT_DEPLOY/besu.log

5. Critérios de Sucesso (Obrigatórios)
Critério	Status Esperado
BC-NSSMF operacional	✅
Besu operacional	✅
Endpoint /api/v1/contract/deploy responde	✅
Contrato implantado on-chain	✅
contract_address.json criado	✅
ABI persistido	✅
Nenhuma alteração de código	✅
Evidências coletadas	✅

⚠️ Se qualquer critério falhar, o protocolo deve ser interrompido e documentado.

6. Entregáveis Esperados

Estrutura final obrigatória:

docs/experiments/C5_E3_CONTRACT_DEPLOY/
├── FASE0_DEPLOYMENT_SNAPSHOT.yaml
├── response_deploy.json
├── bc_nssmf_deploy.log
├── besu.log
