1. Objetivo (revisado)

Este protocolo tem como objetivo eliminar o estado degraded do mÃ³dulo BC-NSSMF, esgotando todas as alternativas operacionais vÃ¡lidas, antes de aceitar qualquer limitaÃ§Ã£o experimental.

ğŸ‘‰ Regra central:

NÃ£o aceitar justificativas enquanto houver soluÃ§Ã£o tÃ©cnica operacional possÃ­vel.

2. PrincÃ­pios obrigatÃ³rios

âŒ NÃ£o alterar cÃ³digo-fonte

âŒ NÃ£o alterar smart contracts

âŒ NÃ£o recompilar imagens

âŒ NÃ£o modificar lÃ³gica de negÃ³cio

âœ… Permitir ajustes de configuraÃ§Ã£o do deployment (portas, replicas, probes)

âœ… Permitir uso de values.yaml jÃ¡ existentes

âœ… Permitir rollback para configuraÃ§Ã£o anterior funcional

âœ… Priorizar estado Running/Ready completo

3. Contexto tÃ©cnico confirmado (entrada do protocolo)

Besu: operacional

BC-NSSMF:

Container A (bc-nssmf) â†’ usa porta 8083

Container B (trisla-bc-nssmf) â†’ tenta usar 8083

Erro:

[Errno 98] address already in use


Causa raiz confirmada: conflito de porta no mesmo pod

4. FASE 0 â€” Snapshot obrigatÃ³rio (antes de qualquer aÃ§Ã£o)
kubectl get deploy trisla-bc-nssmf -n trisla -o yaml > \
docs/experiments/C5_E3/FASE0_DEPLOYMENT_SNAPSHOT.yaml

kubectl describe pod -n trisla -l app=trisla-bc-nssmf > \
docs/experiments/C5_E3/FASE0_POD_DESCRIBE.txt


ğŸ“Œ Esse snapshot garante rastreabilidade cientÃ­fica.

5. FASE 1 â€” ValidaÃ§Ã£o do design esperado do BC-NSSMF
5.1 Verificar se ambos os containers sÃ£o realmente necessÃ¡rios
kubectl get deploy trisla-bc-nssmf -n trisla -o jsonpath='{.spec.template.spec.containers[*].name}'


CritÃ©rio:

Se um container for sidecar de mÃ©tricas ou wrapper, ele nÃ£o deve escutar 8083

6. FASE 2 â€” CorreÃ§Ã£o operacional via configuraÃ§Ã£o (SEM cÃ³digo)
6.1 EstratÃ©gia A â€” SeparaÃ§Ã£o de portas (PRIORITÃRIA)

Editar somente o deployment, ajustando a porta de UM dos containers:

kubectl edit deployment trisla-bc-nssmf -n trisla


AÃ§Ã£o permitida:

Alterar containerPort do container secundÃ¡rio de 8083 â†’ 8084

Ajustar readinessProbe / livenessProbe para a nova porta

ğŸ“Œ Isso Ã© configuraÃ§Ã£o, nÃ£o desenvolvimento.

6.2 EstratÃ©gia B â€” Remover container redundante (SE aplicÃ¡vel)

Se o segundo container for apenas:

wrapper,

proxy,

duplicaÃ§Ã£o histÃ³rica,

entÃ£o:

Remover somente o container redundante do deployment

Manter container funcional (bc-nssmf)

ğŸ“Œ Isso nÃ£o altera cÃ³digo, apenas corrige erro de empacotamento.

6.3 EstratÃ©gia C â€” Escala para 1 rÃ©plica (fallback)
kubectl scale deployment trisla-bc-nssmf -n trisla --replicas=1


Usar apenas se probes estiverem conflitando entre rÃ©plicas.

7. FASE 3 â€” Reconcile e estabilizaÃ§Ã£o
kubectl rollout restart deployment trisla-bc-nssmf -n trisla
kubectl rollout status deployment trisla-bc-nssmf -n trisla


Validar:

kubectl get pods -n trisla | grep bc-nssmf
kubectl logs -n trisla -l app=trisla-bc-nssmf --tail=50

8. CritÃ©rios de sucesso (NÃƒO NEGOCIÃVEIS)
CritÃ©rio	ObrigatÃ³rio
Todos os containers Running	âœ…
Zero CrashLoopBackOff	âœ…
Porta Ãºnica por container	âœ…
Health checks OK	âœ…
Conectividade com Besu	âœ…

ğŸ‘‰ Se qualquer critÃ©rio falhar, retornar Ã  FASE 2.

9. FASE 4 â€” Teste funcional mÃ­nimo (obrigatÃ³rio)

ApÃ³s estabilizaÃ§Ã£o:

curl http://<BC_NSSMF_CLUSTER_IP>:8083/health
curl http://<BC_NSSMF_CLUSTER_IP>:8083/metrics


Registrar respostas.

10. CritÃ©rio de saÃ­da global do PROMPT_C5_E3_v2

O protocolo SÃ“ PODE SER ENCERRADO se:

BC-NSSMF estiver 100% operacional

Sem justificativa de â€œmodo degradedâ€

Sem pendÃªncia tÃ©cnica remanescente

ğŸ“Œ Se nÃ£o for possÃ­vel, o relatÃ³rio deve provar tecnicamente que NÃƒO hÃ¡ soluÃ§Ã£o operacional, o que ainda nÃ£o Ã© o caso aqui.

11. Continuidade obrigatÃ³ria apÃ³s sucesso

Somente apÃ³s BC-NSSMF estabilizado, executar:

PROMPT_C5_E3_TESTES_CONTRATUAIS

PROMPT_C5_NASP_MANUAL
