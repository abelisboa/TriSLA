version: "3.9"

services:
  besu-dev:
    image: hyperledger/besu:23.10.1
    entrypoint: [""]  # desativa entrypoint padrÃ£o
    command: >
      besu
      --data-path=/opt/besu/data
      --genesis-file=/opt/besu/genesis.json
      --network-id=1337
      --rpc-http-enabled=true
      --rpc-http-host=0.0.0.0
      --rpc-http-port=8545
      --rpc-http-api=ETH,NET,WEB3,ADMIN,DEBUG
      --rpc-http-cors-origins=*
      --host-allowlist=*
      --rpc-ws-enabled=true
      --rpc-ws-host=0.0.0.0
      --rpc-ws-port=8546
      --sync-mode=FULL
      --logging=INFO
    volumes:
      - ./genesis.json:/opt/besu/genesis.json
      - ./data:/opt/besu/data
    ports:
      - "8545:8545"
      - "8546:8546"
      - "30303:30303"
    healthcheck:
      test: ["CMD", "curl", "-f", "-X", "POST", "http://localhost:8545", "-H", "Content-Type: application/json", "--data", "{\"jsonrpc\":\"2.0\",\"method\":\"eth_blockNumber\",\"params\":[],\"id\":1}"]
      interval: 10s
      timeout: 5s
      retries: 10
    networks:
      - trisla-network

networks:
  trisla-network:
    driver: bridge
