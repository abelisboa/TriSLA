PROMPT MESTRE â€“ PORTAL TRISLA (NODEPORT + SSH)

Quero que vocÃª configure, gere, empacote, publique e instale o Portal TriSLA (frontend + backend) dentro do cluster NASP, seguindo estritamente estas instruÃ§Ãµes:

ðŸ”¶ FASE 0 â€” Checklist inicial (obrigatÃ³rio)

Antes de executar qualquer coisa, o Cursor deve:

Validar que estÃ¡ no repositÃ³rio local TriSLA-Portal

Validar que existem pastas /backend e /frontend

Parar imediatamente se nÃ£o estiver no repositÃ³rio correto

ðŸ”¶ FASE 1 â€” Gerar Dockerfiles padronizados
Backend

Gerar backend/Dockerfile com:

Python 3.10-slim

InstalaÃ§Ã£o via pip install -r requirements.txt

uvicorn exposto em 0.0.0.0:8001

OTLP desabilitado por padrÃ£o

Nas variÃ¡veis de ambiente, apontar para os mÃ³dulos NASP:

SEM_CSMF_URL=http://trisla-sem-csmf:8080
ML_NSMF_URL=http://trisla-ml-nsmf:8081
DECISION_ENGINE_URL=http://trisla-decision-engine:8082
BC_NSSMF_URL=http://trisla-bc-nssmf:8083
SLA_AGENT_URL=http://trisla-sla-agent-layer:8084

Frontend

Gerar frontend/Dockerfile com:

Node 20

Build com npm install && npm run build

Servir estÃ¡tico com nginx

Ambiente em tempo de execuÃ§Ã£o via env.js

ðŸ”¶ FASE 2 â€” Gerar Helm Chart completo

Criar pasta:

helm/trisla-portal/


Arquivos obrigatÃ³rios:

values.yaml

Com:

frontend:
  nodePort: 32001

backend:
  nodePort: 32002

env:
  SEM_CSMF_URL: http://trisla-sem-csmf:8080
  ML_NSMF_URL: http://trisla-ml-nsmf:8081
  DECISION_ENGINE_URL: http://trisla-decision-engine:8082
  BC_NSSMF_URL: http://trisla-bc-nssmf:8083
  SLA_AGENT_URL: http://trisla-sla-agent-layer:8084

Frontend NodePort service
type: NodePort
port: 80
targetPort: 80
nodePort: 32001

Backend NodePort service
type: NodePort
port: 8001
targetPort: 8001
nodePort: 32002

Deployment

O backend deve iniciar com health-check:

/health  (liveness)
/nasp/diagnostics  (readiness)

ðŸ”¶ FASE 3 â€” Scripts de Build e Push

Gerar scripts:

scripts/build_backend.sh
scripts/build_frontend.sh
scripts/push_backend.sh
scripts/push_frontend.sh


Para ghcr.io/abelisboa.

ðŸ”¶ FASE 4 â€” Deploy no NASP

Gerar script:

scripts/deploy_portal_nasp.sh


ConteÃºdo:

helm upgrade --install trisla-portal ./helm/trisla-portal \
  -n trisla \
  --create-namespace \
  --wait

ðŸ”¶ FASE 5 â€” Criar script de tÃºnel SSH para o usuÃ¡rio

Criar:

scripts/create_tunnel.sh


ConteÃºdo:

ssh -L 32001:localhost:32001 \
    -L 32002:localhost:32002 \
    porvir5g@node1

ðŸ”¶ FASE 6 â€” VerificaÃ§Ã£o automÃ¡tica pÃ³s-instalaÃ§Ã£o

Gerar script:

scripts/verify_portal.sh


Ele deve:

Testar backend:

curl http://localhost:32002/health


Testar frontend:

curl -I http://localhost:32001


Testar o fluxo completo:

POST /api/v1/sla/submit


Validar acesso aos mÃ³dulos NASP com timeout de 1s.

ðŸ”¶ FASE 7 â€” Resultado Final esperado

Ao final, o Cursor deve me retornar:

Todos os arquivos gerados

Todos os comandos para build

Comandos de deploy

Comandos de tÃºnel

InstruÃ§Ãµes finais para acessar o Portal:

Frontend: http://localhost:32001
Backend: http://localhost:32002

ðŸ”¥ IMPORTANTE

O Cursor nÃ£o deve executar nenhum comando destrutivo automaticamente.
Tudo deve pedir confirmaÃ§Ã£o antes de executar.